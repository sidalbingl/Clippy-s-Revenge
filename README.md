# Evil Clippy ğŸƒğŸ‘»

> **Kiroween 2025 Hackathon Submission - Resurrection Category**

Evil Clippy haunts your code with AI-powered sarcastic commentary and horror-themed visual effects. Built entirely using Kiro IDE's features in 40 hours.

[![Demo Video](https://img.shields.io/badge/Demo-Watch%20Video-red)](YOUR_VIDEO_URL)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Built with Kiro](https://img.shields.io/badge/Built%20with-Kiro-purple)](https://kiro.ai)

## ğŸ¯ Kiroween Submission Highlights

- **Category**: Resurrection
- **Kiro Features Used**: Vibe Coding, Spec-Driven Development, Steering Docs, Agent Hooks, MCP
- **Development Time**: 40 hours with Kiro (estimated 120+ hours without)
- **Code Generated by Kiro**: 81% (~3,500 lines)
- **Time Saved**: 80 hours (67% faster)

**ğŸ“– Complete Kiro Usage Story**: [`.kiro/specs/evil_clippy_development_journey.md`](.kiro/specs/evil_clippy_development_journey.md)

## ğŸ“‘ Table of Contents

- [Features](#-features)
- [How It Works](#how-it-works)
- [Project Structure](#project-structure)
- [AI Analysis](#ai-analysis)
- [Avatar & Effects](#avatar--effects)
- [Setup](#setup)
- [Configuration](#configuration)
- [Kiro Integration](#-kiro-integration)
- [For Kiroween Judges](#-for-kiroween-judges)

## âœ¨ Features

- ğŸ¤– **AI-Powered Analysis** - Gemini 2.5 Flash analyzes your code in real-time
- ğŸ˜ˆ **Sarcastic Commentary** - Brutal but helpful feedback with dark humor
- ğŸ©¸ **Blood Drip Effect** - Realistic blood animations on high severity errors
- âš¡ **Glitch Effect** - RGB split and screen distortion for bad code
- ğŸ“³ **Screen Shake** - Intensity-based on code severity
- ğŸ’¬ **Smart Fallback** - Local analysis when AI is unavailable
- âš¡ **Fast & Cached** - Response caching (80% hit rate) and rate limiting
- ğŸƒ **Horror Theme** - Dark, spooky aesthetic with Windows 95 nostalgia
- ğŸ­ **60fps Performance** - Optimized animations on low-end hardware

## How It Works

### Complete Flow

```
User saves code file
    â†“
Chokidar detects change (src/mcp/index.ts)
    â†“
Smart Analyzer checks cache
    â†“
Gemini 2.5 Flash analyzes code (src/mcp/services/geminiService.ts)
    â”œâ”€ Determines severity (low/medium/high)
    â”œâ”€ Generates sarcastic message
    â””â”€ Provides technical advice
    â†“
If Gemini fails â†’ Local fallback (src/mcp/analyzers/codeQualityAnalyzer.ts)
    â†“
Result cached for 15 minutes
    â†“
Electron Main forwards via IPC (src/main/main.ts)
    â†“
Renderer receives event (src/renderer/hooks/useClippyState.ts)
    â†“
Clippy displays message with effects:
    - Low: Message only (12 seconds)
    - Medium: Message + Shake (10 seconds)
    - High: Message + Shake + Glitch + Red Flash (8 seconds)
```

## Project Structure

```
src/
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ main.ts          # Electron main process
â”‚   â””â”€â”€ preload.ts       # IPC bridge
â”œâ”€â”€ mcp/
â”‚   â”œâ”€â”€ index.ts         # File watcher + event dispatcher
â”‚   â”œâ”€â”€ analyzers/
â”‚   â”‚   â”œâ”€â”€ smartAnalyzer.ts         # Gemini + fallback orchestrator
â”‚   â”‚   â”œâ”€â”€ codeQualityAnalyzer.ts   # Local fallback analysis
â”‚   â”‚   â””â”€â”€ laughDetector.ts         # Embarrassing pattern detector
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ geminiService.ts         # Gemini 2.5 Flash API client
â”‚   â”‚   â”œâ”€â”€ cacheService.ts          # Response caching (15 min TTL)
â”‚   â”‚   â””â”€â”€ rateLimiter.ts           # Rate limiting (10/min)
â”‚   â””â”€â”€ responseEngine/
â”‚       â”œâ”€â”€ index.ts                 # Fallback message generator
â”‚       â””â”€â”€ insults.ts               # Predefined insult collections
â””â”€â”€ renderer/
    â”œâ”€â”€ App.tsx          # Main UI + effect orchestration
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ Avatar.tsx           # Clippy avatar with animations
    â”‚   â””â”€â”€ SpeechBubble.tsx     # Speech bubble with typing effect
    â””â”€â”€ hooks/
        â”œâ”€â”€ useClippyState.ts    # State management + event handling
        â”œâ”€â”€ useFloatingMotion.ts # Floating animation
        â””â”€â”€ effects/
            â”œâ”€â”€ useShake.ts      # Shake effect hook
            â”œâ”€â”€ useGlitch.ts     # Glitch effect hook
            â””â”€â”€ useSound.ts      # Sound effect hook
```

## AI Analysis

### Gemini 2.5 Flash
- **Model**: `gemini-2.5-flash` via `@google/genai` SDK
- **Prompt**: Sarcastic code critic with dark humor
- **Output**: Severity + 2 short sarcastic sentences + technical advice
- **Cache**: 15 minute TTL to reduce API calls
- **Rate Limit**: 10 requests per minute

### Severity Levels
- **HIGH**: Security vulnerabilities, crashes, data loss
- **MEDIUM**: Bad practices, anti-patterns
- **LOW**: Style issues, minor problems

### Fallback System
If Gemini fails (API down, rate limit, no key):
- Local regex-based analysis
- Predefined sarcastic messages
- Same severity detection logic

## Avatar & Effects

### Avatar States
- `idle` - Floating animation
- `analyzing` - Orange eyes
- `angry` - Red eyes, furious expression
- `inactivity_warning` - Bouncing animation

### Visual Effects
- **Shake**: Medium (450ms) or High (700ms) intensity
- **Glitch**: Color channel offset + hue rotation (600ms)
- **Red Flash**: Brief red overlay for high severity
- **Audio**: Severity-based sound effects

### Scary Laugh (HIGH Severity Only)
Evil Clippy's signature scary laugh plays automatically for HIGH severity errors (no other sound):
- Security vulnerabilities (eval, SQL injection)
- Critical bugs that could crash the app
- Data loss risks
- Unsafe code patterns
- Triggers: Shake + Glitch + Red Flash + Scary Laugh

### Easter Eggs ğŸ¥š

**Click Avatar:**
Click on Clippy's avatar repeatedly for increasingly creepy messages:
- 1st click: "Stop poking me, mortal... ğŸ‘ï¸"
- 5th click: Shake effect + "I know what you did in that last commit... ğŸ’€"
- 10th click: Glitch effect + evil laugh + "Fine. You win. But I'm still judging you... ğŸ˜’"
- Each click within 2 seconds continues the sequence, otherwise resets

**Inactivity Warning:**
- After 2 minutes: "Where are you" sound (9 seconds) + shake + light message
- After 5 minutes: Harsher message with annoyed emotion

## Setup

### 1. Install Dependencies
```bash
npm install
```

### 2. Get Gemini API Key
1. Go to https://aistudio.google.com/app/apikey
2. Create a new API key
3. Copy the key

### 3. Configure Environment
Create `.env` file:
```env
GEMINI_API_KEY=your_api_key_here
GEMINI_MAX_REQUESTS_PER_MINUTE=10
GEMINI_CACHE_TTL_MINUTES=15
```

### 4. Run Development Mode
```bash
# Terminal 1: Start Vite dev server
npm run dev:renderer

# Terminal 2: Start Electron
npm start
```

This starts:
1. Vite dev server on http://localhost:5173
2. Electron app with hot reload
3. File watcher on current directory
4. Gemini API integration

### 5. Test Evil Clippy

Use the included test files to trigger different severity levels:

**LOW Severity** (`test-low-severity.js`):
- Console.log spam
- Magic numbers
- Inconsistent naming
- Missing error handling

**MEDIUM Severity** (`test-bad-css.css`):
- Nested selectors
- !important overuse
- Duplicate properties

**HIGH Severity** (`test-high-severity.js`):
- eval() usage
- SQL injection vulnerability
- Unsafe innerHTML
- Effects: Shake + Glitch + Red Flash + **Scary Laugh** ğŸ˜ˆ

Simply edit and save any test file to see Clippy's reaction!

**Note:** Clippy moves to center when showing a message, then resumes floating motion after typing completes (message stays visible while moving).

### 6. Build for Production
```bash
npm run build
npm start
```

## Configuration

### Environment Variables
- `GEMINI_API_KEY` - Your Gemini API key (required for AI)
- `GEMINI_MAX_REQUESTS_PER_MINUTE` - Rate limit (default: 10)
- `GEMINI_CACHE_TTL_MINUTES` - Cache duration (default: 15)

### Watch Directory
- Dev mode: Auto-watches current directory
- Production: Can be configured via IPC

### Customizing Clippy's Personality
Edit `src/mcp/services/geminiService.ts` â†’ `buildPrompt()` method:
- Change tone (more/less sarcastic)
- Adjust message length
- Add custom examples
- Modify severity rules

## Performance & Features

- **Async Analysis**: Non-blocking file analysis
- **Smart Caching**: 15-minute cache reduces API calls (80% hit rate)
- **Rate Limiting**: 10 requests/minute prevents quota exhaustion
- **GPU Animations**: CSS-based effects for 60fps performance
- **Debounced Watching**: 500ms stabilization prevents spam
- **Speech Bubble**: Positioned next to avatar with typing animation
- **Floating Motion**: Physics-based movement with pause/resume
- **Click-through**: Window becomes transparent when not interacting

## Troubleshooting

### Gemini Not Working
1. Check API key in `.env`
2. Verify key is active at https://aistudio.google.com
3. Check console for error messages
4. System will fallback to local analysis automatically

### Clippy Not Appearing
1. Ensure both `npm run dev:renderer` and `npm start` are running
2. Check Electron window is open (look in taskbar)
3. Try Alt+Tab to find the window

### Messages Too Fast/Slow
Edit `src/renderer/components/SpeechBubble.tsx` line 64:
```typescript
const displayDuration = emotion === 'furious' ? 8000 : emotion === 'annoyed' ? 10000 : 12000;
```

## ğŸƒ Kiro Integration

Evil Clippy showcases comprehensive Kiro IDE integration:

### Vibe Coding (Chat-Based Development)
- Generated 1,200+ lines of UI code through natural conversation
- Created Electron IPC bridge, React components, and visual effects
- **Most impressive**: Complete floating animation hook from single prompt

### Spec-Driven Development
- [`mcp_server.md`](.kiro/specs/mcp_server.md) - Planned MCP architecture, prevented 3+ refactors
- [`persona_behavior.md`](.kiro/specs/persona_behavior.md) - Defined AI personality rules
- **Impact**: Saved 14+ hours by planning complex systems upfront

### Steering Documents
- [`clippy_dark_persona.md`](.kiro/steering/clippy_dark_persona.md) - Taught Kiro Evil Clippy's personality
- Enabled consistent tone across 50+ AI-generated responses
- **Result**: 70% faster response writing with perfect consistency

### Agent Hooks
- [`test-on-save.json`](.kiro/hooks/test-on-save.json) - Auto-run tests, caught 12 bugs
- [`generate-effects.json`](.kiro/hooks/generate-effects.json) - Automated effect generation
- [`dark-commits.json`](.kiro/hooks/dark-commits.json) - Generated dark humor commit messages
- **Impact**: Saved 5+ hours on repetitive tasks

### MCP (Model Context Protocol)
- Custom MCP server for real-time file watching and AI analysis
- Enabled Gemini API integration (impossible in renderer process)
- Persistent caching and rate limiting
- **Performance**: 200-500ms analysis (10ms when cached)

**ğŸ“Š Detailed Metrics**: See [`.kiro/README.md`](.kiro/README.md) for complete impact analysis

## ğŸ† For Kiroween Judges

This project demonstrates:
1. **Complete Kiro Integration** - Used ALL major features effectively
2. **Measurable Impact** - 81% code generation, 67% time saved, 12 bugs caught
3. **Creative Execution** - Unique twist on code review with horror aesthetics
4. **Technical Depth** - Complex MCP integration with AI, caching, and fallbacks
5. **Polished Design** - 60fps horror effects that enhance functionality

**Read the full development story**: [`.kiro/specs/evil_clippy_development_journey.md`](.kiro/specs/evil_clippy_development_journey.md)

## ğŸ¤ Contributing

Contributions welcome! This is an open-source project built for Kiroween 2025.

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Submit a pull request

## ğŸ“„ License

MIT License - see [LICENSE](LICENSE) file for details

## ğŸ™ Acknowledgments

- Built with [Kiro IDE](https://kiro.ai) for Kiroween 2025
- Powered by [Gemini 2.5 Flash](https://ai.google.dev/)
- Inspired by the original Clippy (RIP 1997-2007)

---

**Built with â¤ï¸ and ğŸƒ for Kiroween 2025**
